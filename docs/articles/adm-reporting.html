<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>adm-reporting • cdhtools</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="adm-reporting">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cdhtools</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adhoc-datasetanalysis.html">adhoc-datasetanalysis</a>
    </li>
    <li>
      <a href="../articles/adm-reporting.html">adm-reporting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>adm-reporting</h1>
                        <h4 class="author">Otto Perdeck</h4>
            
            <h4 class="date">2018-11-07</h4>
      
      
      <div class="hidden name"><code>adm-reporting.Rmd</code></div>

    </div>

    
    
<div id="adm-datamart" class="section level1">
<h1 class="hasAnchor">
<a href="#adm-datamart" class="anchor"></a>ADM Datamart</h1>
<p>The ADM Datamart is an open database schema where the ADM models and all predictors are copied into. The standard ADM reports both in Analytics Center as well as in the Report Browser (Adaptive category) work off this schema.</p>
<p>Since the schema is open we can easily use it to create our own reports and support measurements and plots not available in the OOTB reporting in Pega.</p>
</div>
<div id="data-loading" class="section level1">
<h1 class="hasAnchor">
<a href="#data-loading" class="anchor"></a>Data Loading</h1>
<p>Let’s first load the data. An example export is provided with the package. Ways to load your own data from the database or from a dataset export will be described later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(cdhtools)
<span class="kw">data</span>(admdatamart_models)
<span class="kw">data</span>(admdatamart_binning)</code></pre></div>
<div id="data-loading-using-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#data-loading-using-datasets" class="anchor"></a>Data Loading using Datasets</h2>
<p>To load your own data, export the datasets from Pega, download them to your filesystem and let the <code>cdhtools</code> library import it. In order to be able to process the data universally we also make sure to make the names lower case and make sure the types are as expected by the snippets that follow below. This would also be a good place to zoom in to specific models relevant to your application.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">admdatamart_models &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readDSExport.html">readDSExport</a></span>(<span class="st">"Data-Decision-ADM-ModelSnapshot"</span>, <span class="st">"~/Downloads"</span>)
<span class="kw">setnames</span>(admdatamart_models, <span class="kw">tolower</span>(<span class="kw">names</span>(admdatamart_models))) <span class="co"># for compatibility with database approach</span>
admdatamart_models[, pyperformance <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.numeric</span>(pyperformance)]

admdatamart_binning &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readDSExport.html">readDSExport</a></span>(<span class="st">"Data-Decision-ADM-PredictorBinningSnapshot"</span>, <span class="st">"~/Downloads"</span>)
<span class="kw">setnames</span>(admdatamart_binning, <span class="kw">tolower</span>(<span class="kw">names</span>(admdatamart_binning))) <span class="co"># for compatibility with database approach</span>
admdatamart_binning[, pyperformance <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.numeric</span>(pyperformance)]

<span class="co"># Filter models relevant to our application</span>
admdatamart_models &lt;-<span class="st"> </span>admdatamart_models[pyconfigurationname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"SalesModel"</span>, <span class="st">"BannerModel"</span>)]</code></pre></div>
</div>
<div id="data-loading-directly-from-the-database" class="section level2">
<h2 class="hasAnchor">
<a href="#data-loading-directly-from-the-database" class="anchor"></a>Data Loading directly from the database</h2>
<p>If you have database access you can also load the data directly from the DB. All you need is a JDBC driver and the proper credentials.</p>
<div id="todo---do-nicely-via-util-function-that-allows-filtering-on-config-etc" class="section level3">
<h3 class="hasAnchor">
<a href="#todo---do-nicely-via-util-function-that-allows-filtering-on-config-etc" class="anchor"></a>TODO - do nicely via util function that allows filtering on config etc</h3>
</div>
</div>
</div>
<div id="advanced-reports" class="section level1">
<h1 class="hasAnchor">
<a href="#advanced-reports" class="anchor"></a>Advanced Reports</h1>
<p>With the data loaded, we can start with a plot similar to what the Analytics Center provides OOTB, however here we can easily include multiple models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(scales)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(data.table)

<span class="kw"><a href="ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(admdatamart_models <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">mutate</span>(<span class="dt">Performance =</span> <span class="dv">100</span><span class="op">*</span>pyperformance,
                <span class="dt">Responses =</span> pypositives<span class="op">+</span>pynegatives,
                <span class="dt">AcceptRate =</span> pypositives<span class="op">/</span>(pypositives<span class="op">+</span>pynegatives)),
       <span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(Performance, AcceptRate, <span class="dt">colour=</span>pyname, <span class="dt">shape=</span>pyconfigurationname, <span class="dt">size=</span><span class="kw">log</span>(Responses)))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="dt">xintercept=</span><span class="kw">c</span>(<span class="dv">52</span>,<span class="dv">90</span>), <span class="dt">linetype=</span><span class="st">"dashed"</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="dt">alpha=</span><span class="fl">0.7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="dt">colour=</span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span>(<span class="dt">title=</span><span class="st">"Proposition"</span>),
         <span class="dt">shape=</span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span>(<span class="dt">title=</span><span class="st">"Model"</span>),
         <span class="dt">size=</span><span class="ot">FALSE</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">100</span>), <span class="dt">name =</span> <span class="st">"Proposition Performance"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">name =</span> <span class="st">"Success Rate"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">panel.background =</span> <span class="kw"><a href="ggplot2.tidyverse.org/reference/element.html">element_rect</a></span>(<span class="dt">fill=</span><span class="st">'lightgreen'</span>))</code></pre></div>
<p><img src="adm-reporting_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>If we group by model instead of proposition, we can see the spread of success rate and performance for all the propositions of one model. In this example, it’s immediately obvious that the Banners have a much lower success rate than the Sales propositions, and also that the Very Simple model has a much lower performance than the (presumably not so simple) Sales model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(admdatamart_models <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">mutate</span>(<span class="dt">Performance =</span> <span class="dv">100</span><span class="op">*</span>pyperformance,
                <span class="dt">Responses =</span> pypositives<span class="op">+</span>pynegatives,
                <span class="dt">AcceptRate =</span> pypositives<span class="op">/</span>(pypositives<span class="op">+</span>pynegatives)),
       <span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(Performance, AcceptRate, <span class="dt">colour=</span>pyconfigurationname))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span>(<span class="dt">alpha=</span><span class="fl">0.7</span>, <span class="dt">outlier.shape=</span><span class="dv">8</span>,
               <span class="dt">outlier.size=</span><span class="dv">6</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="dt">colour=</span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span>(<span class="dt">title=</span><span class="st">"Model"</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">70</span>), <span class="dt">name =</span> <span class="st">"Model Performance"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">name =</span> <span class="st">"Success Rate"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">panel.background =</span> <span class="kw"><a href="ggplot2.tidyverse.org/reference/element.html">element_rect</a></span>(<span class="dt">fill=</span><span class="st">'lightgreen'</span>))</code></pre></div>
<p><img src="adm-reporting_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The below plot shows the predictor performance across the selected models. It is similar to one of the reports in the set of out of the box reports available through the Report Browser (“Adaptive” category), however that one does not do a weighted average of the performance. This one does, so gives a more accurate picture.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(admdatamart_binning <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pyentrytype <span class="op">!=</span><span class="st"> "Classifier"</span>) <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">group_by</span>(pymodelid, pypredictorname, pytype) <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">summarise</span>(<span class="dt">pyperformance =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/first">first</a></span>(pyperformance),
                   <span class="dt">evidence =</span> <span class="kw">sum</span>(pybinpositives<span class="op">+</span>pybinnegatives)) <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">arrange</span>(pypredictorname) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">         </span><span class="kw">group_by</span>(pypredictorname, pytype) <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">summarise</span>(<span class="dt">weightedperformance =</span> <span class="kw">sum</span>(evidence<span class="op">*</span>pyperformance)<span class="op">/</span><span class="kw">sum</span>(evidence)) <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">arrange</span>(weightedperformance),
       <span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">factor</span>(pypredictorname, <span class="dt">levels=</span><span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/duplicated">unique</a></span>(pypredictorname)), <span class="dv">100</span><span class="op">*</span>weightedperformance, <span class="dt">fill=</span>pytype)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="dt">stat=</span><span class="st">"identity"</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="dt">fill=</span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span>(<span class="dt">title=</span><span class="st">"Predictor Type"</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>()<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">""</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Weighted avg Predictor Performance"</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">60</span>),<span class="dt">oob =</span> rescale_none, <span class="dt">name =</span> <span class="st">"AUC"</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="dt">yintercept=</span><span class="kw">c</span>(<span class="dv">52</span>), <span class="dt">linetype=</span><span class="st">"dashed"</span>)</code></pre></div>
<p><img src="adm-reporting_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>You could also show the predictor performance in one plot across all predictors for all the selected models. Also arranging by performance in both dimensions gives a quick visual clue of which predictors and which models need attention.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">performanceSummary &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(admdatamart_binning[, .(<span class="dt">auc =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/first">first</a></span>(pyperformance)), <span class="dt">by=</span><span class="kw">c</span>(<span class="st">"pymodelid"</span>, <span class="st">"pysnapshottime"</span>, <span class="st">"pypredictorname"</span>)],
            admdatamart_models,
            <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"pymodelid"</span>,<span class="st">"pysnapshottime"</span>))
<span class="co"># maps AUC 0.5 .. 1.0 to a measure of goodness 0 .. 1 just for viz</span>
myGoodness &lt;-<span class="st"> </span><span class="cf">function</span>(x)
{
  minOK &lt;-<span class="st"> </span><span class="fl">0.52</span>
  maxOK &lt;-<span class="st"> </span><span class="fl">0.85</span>
  midPt &lt;-<span class="st"> </span><span class="fl">0.3</span>
  <span class="kw">return</span> (<span class="kw">ifelse</span>(x <span class="op">&lt;</span><span class="st"> </span>minOK, midPt<span class="op">*</span>(x<span class="op">-</span><span class="fl">0.5</span>)<span class="op">/</span>(minOK<span class="op">-</span><span class="fl">0.5</span>), 
                 <span class="kw">ifelse</span>(x <span class="op">&lt;</span><span class="st"> </span>maxOK, midPt<span class="op">+</span>(<span class="dv">1</span><span class="op">-</span>midPt)<span class="op">*</span>(x<span class="op">-</span>minOK)<span class="op">/</span>(maxOK<span class="op">-</span>minOK), 
                        <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(x<span class="op">-</span>maxOK)<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>maxOK))))
}
## Plot of AUC of predictors x models
meanByModel &lt;-<span class="st"> </span><span class="kw">group_by</span>(<span class="kw">filter</span>(performanceSummary, pypredictorname<span class="op">==</span><span class="st">"Classifier"</span>), pyname) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">goodness =</span> <span class="kw">mean</span>(<span class="kw">myGoodness</span>(auc), <span class="dt">na.rm=</span>T),
                   <span class="dt">auc =</span> <span class="kw">mean</span>(auc, <span class="dt">na.rm=</span>T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(goodness))
meanByPredictor &lt;-<span class="st"> </span><span class="kw">group_by</span>(performanceSummary, pypredictorname) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">goodness =</span> <span class="kw">mean</span>(<span class="kw">myGoodness</span>(auc), <span class="dt">na.rm=</span>T),
                   <span class="dt">auc =</span> <span class="kw">mean</span>(auc, <span class="dt">na.rm=</span>T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(goodness)
<span class="kw"><a href="ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">filter</span>(performanceSummary, pypredictorname<span class="op">!=</span><span class="st">"Classifier"</span>), 
       <span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x=</span><span class="kw">factor</span>(pyname, <span class="dt">levels=</span>meanByModel<span class="op">$</span>pyname), 
       <span class="dt">y=</span><span class="kw">factor</span>(pypredictorname,<span class="dt">levels=</span><span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/setops">setdiff</a></span>(meanByPredictor<span class="op">$</span>pypredictorname, <span class="st">"Classifier"</span>))))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span>(<span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">fill=</span><span class="kw">myGoodness</span>(auc)))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span>(<span class="dt">low=</span><span class="st">"red"</span>, <span class="dt">mid=</span><span class="st">"green"</span>, <span class="dt">high=</span><span class="st">"white"</span>, <span class="dt">midpoint=</span><span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">x=</span><span class="st">""</span>,<span class="dt">y=</span><span class="st">""</span>,<span class="dt">title=</span><span class="st">"Predictors arranged by performance across models"</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">label=</span><span class="kw">sprintf</span>(<span class="st">"%.2f"</span>,<span class="dv">100</span><span class="op">*</span>auc)), <span class="dt">size=</span><span class="dv">2</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">axis.text.x =</span> <span class="kw"><a href="ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">size =</span> <span class="dv">5</span>), <span class="dt">axis.text.y =</span> <span class="kw"><a href="ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="dt">size =</span> <span class="dv">5</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="dt">fill=</span>F)</code></pre></div>
<p><img src="adm-reporting_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="alternative-performance-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#alternative-performance-metrics" class="anchor"></a>Alternative Performance Metrics</h1>
<p>With all the data available in the datamart, you are not restricted to just reporting. Using the binning information for all of the predictors, you could, for example, calculate the KS score of the models. The KS (Kolmogorov–Smirnov) score is related to the AUC that we use by default, but instead of the areas under the ROC curve, it gives the maximum separation between the true positive and false positive rate.</p>
<p>The below snippet calculates the KS score for all predictors of all propositions and shows them next to AUC reported by ADM.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">admdatamart_binning[ , propensity <span class="op">:</span><span class="er">=</span><span class="st"> </span>pybinpositives<span class="op">/</span>(pybinpositives<span class="op">+</span>pybinnegatives)]
<span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/setorder">setorder</a></span>(admdatamart_binning,propensity)
myKS &lt;-<span class="st"> </span><span class="cf">function</span>(binning)
{
  Goods &lt;-<span class="st"> </span><span class="kw">cumsum</span>(binning<span class="op">$</span>pybinnegatives) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(binning<span class="op">$</span>pybinnegatives)
  Bads &lt;-<span class="st"> </span><span class="kw">cumsum</span>(binning<span class="op">$</span>pybinpositives) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(binning<span class="op">$</span>pybinpositives)
  ks &lt;-<span class="st"> </span>(<span class="kw">max</span>(Goods <span class="op">-</span><span class="st"> </span>Bads))
  <span class="kw">return</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(ks),<span class="dv">0</span>,ks))
}
performanceSummary &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(admdatamart_binning[, .(<span class="dt">ks =</span> <span class="kw">myKS</span>(.SD),
                           <span class="dt">auc =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/first">first</a></span>(pyperformance)), 
                       <span class="dt">by=</span><span class="kw">c</span>(<span class="st">"pymodelid"</span>, <span class="st">"pysnapshottime"</span>, <span class="st">"pypredictorname"</span>,<span class="st">"pyentrytype"</span>)],
            admdatamart_models,
            <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"pymodelid"</span>,<span class="st">"pysnapshottime"</span>))

## Show KS numbers
<span class="kw"><a href="ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(performanceSummary, 
       <span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(pyname, <span class="kw">factor</span>(pypredictorname,
                          <span class="dt">levels=</span><span class="kw">c</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/setops">setdiff</a></span>(<span class="kw">sort</span>(performanceSummary<span class="op">$</span>pypredictorname,<span class="dt">decreasing =</span> T), <span class="st">"Classifier"</span>),<span class="st">"Classifier"</span>))))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span>(<span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">fill=</span>(pyentrytype<span class="op">==</span><span class="st">"Classifier"</span>)))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">x=</span><span class="st">""</span>,<span class="dt">y=</span><span class="st">""</span>,<span class="dt">title=</span><span class="st">"Kolmogorov–Smirnov scores"</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">label=</span><span class="kw">sprintf</span>(<span class="st">"%.2f%%"</span>,<span class="dv">100</span><span class="op">*</span>ks)), <span class="dt">size=</span><span class="dv">2</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span>(<span class="dt">palette=</span><span class="st">"Spectral"</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="dt">fill=</span>F)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">axis.text.x =</span> <span class="kw"><a href="ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="dt">size=</span><span class="dv">6</span>),
        <span class="dt">axis.text.y =</span> <span class="kw"><a href="ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="dt">size=</span><span class="dv">6</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span>(<span class="dt">position =</span> <span class="st">"top"</span>)</code></pre></div>
<p><img src="adm-reporting_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="gains-and-lift-charts" class="section level1">
<h1 class="hasAnchor">
<a href="#gains-and-lift-charts" class="anchor"></a>Gains and Lift Charts</h1>
<p>The predictor data for the model classifiers can also be used to create gains or lift charts, as an alternative to the bin-oriented propensity plot that is available in the Analytics Center.</p>
<p>For example, Gains charts for the Banner models:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">classifierdata &lt;-<span class="st"> </span>admdatamart_binning[pyentrytype<span class="op">==</span><span class="st">"Classifier"</span> <span class="op">&amp;</span><span class="st"> </span>
<span class="st">                                        </span>pymodelid <span class="op">%in%</span><span class="st"> </span>admdatamart_models[pyconfigurationname<span class="op">==</span><span class="st">"BannerModel"</span> <span class="op">&amp;</span>
<span class="st">                                                                            </span>pysnapshottime<span class="op">==</span><span class="kw">max</span>(pysnapshottime)]<span class="op">$</span>pymodelid,
                                      <span class="kw">c</span>(<span class="st">"pybinindex"</span>, <span class="st">"pybinnegatives"</span>, <span class="st">"pybinpositives"</span>, <span class="st">"propensity"</span>, <span class="st">"pylift"</span>, <span class="st">"pymodelid"</span>)]
<span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/setorder">setorder</a></span>(classifierdata,<span class="op">-</span>pybinindex)

classifierdata[,cumRelativeVolume <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">cumsum</span>((pybinnegatives<span class="op">+</span>pybinpositives)<span class="op">/</span><span class="kw">sum</span>(pybinnegatives<span class="op">+</span>pybinpositives)), by=pymodelid]
classifierdata[,cumRelativePositives <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">cumsum</span>((pybinpositives)<span class="op">/</span><span class="kw">sum</span>(pybinpositives)), by=pymodelid]
classifierdata[,Banner <span class="op">:</span><span class="er">=</span><span class="st"> </span>admdatamart_models<span class="op">$</span>pyname[admdatamart_models<span class="op">$</span>pymodelid <span class="op">==</span><span class="st"> </span>pymodelid][<span class="dv">1</span>], by=pymodelid]

<span class="kw"><a href="ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(classifierdata, <span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(cumRelativeVolume, cumRelativePositives, <span class="dt">color=</span>Banner)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">color=</span><span class="st">"red"</span>, <span class="dt">linetype=</span><span class="st">"dashed"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">name =</span> <span class="st">"Percentile"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">name =</span> <span class="st">"Percentage of Clicks"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="dt">color=</span>F) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span>Banner)<span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Gains Chart for Banner Models"</span>)</code></pre></div>
<p><img src="adm-reporting_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Or a Lift chart for the same models:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">classifierdata[,lift <span class="op">:</span><span class="er">=</span><span class="st"> </span>(<span class="kw">cumsum</span>(pybinpositives)<span class="op">/</span><span class="kw">cumsum</span>(pybinnegatives<span class="op">+</span>pybinpositives)) <span class="op">/</span><span class="st"> </span>(<span class="kw">sum</span>(pybinpositives)<span class="op">/</span><span class="kw">sum</span>(pybinnegatives<span class="op">+</span>pybinpositives)), by=pymodelid]

<span class="kw"><a href="ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(classifierdata, <span class="kw"><a href="ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(cumRelativeVolume, lift, <span class="dt">color=</span>Banner)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">color=</span><span class="st">"red"</span>, <span class="dt">linetype=</span><span class="st">"dashed"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">name =</span> <span class="st">"Percentile"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>), <span class="dt">name =</span> <span class="st">"Lift"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Lift Chart for Banner Models"</span>)</code></pre></div>
<p><img src="adm-reporting_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="other-ideas" class="section level1">
<h1 class="hasAnchor">
<a href="#other-ideas" class="anchor"></a>Other Ideas</h1>
<p>A lot more plots could easily be created. The above are just examples. Showing changes over time would, for example, also be easy to do.</p>
<p>If you have ideas/needs for additional plots please contact us. Create them and put a PR in GitHub or contact us via an Issue.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#adm-datamart">ADM Datamart</a></li>
      <li>
<a href="#data-loading">Data Loading</a><ul class="nav nav-pills nav-stacked">
<li><a href="#data-loading-using-datasets">Data Loading using Datasets</a></li>
      <li><a href="#data-loading-directly-from-the-database">Data Loading directly from the database</a></li>
      </ul>
</li>
      <li><a href="#advanced-reports">Advanced Reports</a></li>
      <li><a href="#alternative-performance-metrics">Alternative Performance Metrics</a></li>
      <li><a href="#gains-and-lift-charts">Gains and Lift Charts</a></li>
      <li><a href="#other-ideas">Other Ideas</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Otto Perdeck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
